<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CaveDaemon.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Coverage of SkyCave</a> &gt; <a href="index.source.html" class="el_package">cloud.cave.main</a> &gt; <span class="el_source">CaveDaemon.java</span></div><h1>CaveDaemon.java</h1><pre class="source lang-java linenums">package cloud.cave.main;

import org.slf4j.*;

import cloud.cave.config.*;
import cloud.cave.domain.Cave;
import cloud.cave.ipc.*;
import cloud.cave.server.*;

/**
 * The 'main' daemon to run on the server side. It uses a ServerFactory that
 * reads all relevant parameters to define the server side delegates
 * (subscription service, database connector, reactor implementation, IPs and
 * ports of connections...).
 * 
 * @see Config
 * 
 * @author Henrik Baerbak Christensen, Aarhus University
 * 
 */
<span class="nc" id="L21">public class CaveDaemon {</span>
  private static Thread daemon; 

  public static void main(String[] args) throws InterruptedException {
    
    // Create the logging
<span class="nc" id="L27">    Logger logger = LoggerFactory.getLogger(CaveDaemon.class);</span>
 
    // Create the abstract factory to create delegates using dependency injection.
    // Here all injected delegates are defined by a set of predefined environment
    // variables.
    CaveServerFactory factory; 
    EnvironmentReaderStrategy envReader;
<span class="nc" id="L34">    envReader = new OSEnvironmentReaderStrategy();</span>
<span class="nc" id="L35">    factory = new EnvironmentServerFactory(envReader);</span>
    
    // Create the server side cave instance
<span class="nc" id="L38">    Cave caveServer = new StandardServerCave(factory);</span>

    // Create the invoker on the server side, and bind it to the cave
<span class="nc" id="L41">    Invoker serverInvoker = new StandardInvoker(caveServer);</span>
    
    // Create the server side reactor...
<span class="nc" id="L44">    Reactor reactor = factory.createReactor(serverInvoker); </span>

    // Make a section in the log file, marking the new session
<span class="nc" id="L47">    logger.info(&quot;=== SkyCave Reactor starting...&quot;);</span>
<span class="nc" id="L48">    logger.info(&quot;Cave Configuration =&quot; + caveServer.describeConfiguration());</span>

    // Welcome 
<span class="nc" id="L51">    System.out.println(&quot;=== SkyCave Reactor ===&quot;); </span>
<span class="nc" id="L52">    System.out.println(&quot;  All logging going to log file...&quot;);</span>
<span class="nc" id="L53">    System.out.println(&quot; Use ctrl-c to terminate!&quot;); </span>
    
    // and start the daemon...
<span class="nc" id="L56">    daemon = new Thread(reactor); </span>
<span class="nc" id="L57">    daemon.start(); </span>
    
    // Ensure that its lifetime follows that of the main process
<span class="nc" id="L60">    daemon.join(); </span>
<span class="nc" id="L61">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201506030918</span></div></body></html>